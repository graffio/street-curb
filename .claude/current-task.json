{
  "feature": "QIF entity string IDs - Simplified",
  "goal": "Generate deterministic string IDs for all entities using simple hashFields (no stateful generators), with proper collision handling via database constraints",
  "templates_used": ["implement-feature.md", "write-tests.md", "commit-changes.md"],
  "steps": [
    { "step": 1, "action": "Update schema.sql: Change all id columns from INTEGER PRIMARY KEY to TEXT PRIMARY KEY", "done": true },
    { "step": 2, "action": "Update schema.sql: Change all foreign key columns to TEXT", "done": true },
    { "step": 3, "action": "Update schema.sql: Add UNIQUE constraints on business keys (accounts.name, categories.name, tags.name, securities(name,symbol), prices(security_id,date))", "done": false },
    { "step": 4, "action": "Simplify generate-entity-id.js: Remove createIdGenerator, keep only hashFields", "done": false },
    { "step": 5, "action": "Update all entity services to use hashFields consistently with explicit field selection", "done": false },
    { "step": 6, "action": "Fix lots.js: Remove circular ID reference, fix Grant/Vest incomplete conditional (line 273)", "done": false },
    { "step": 7, "action": "Standardize null handling: Use null consistently instead of empty string fallbacks", "done": false },
    { "step": 8, "action": "Update type definitions: Use consistent ID patterns without ordinal suffixes", "done": false },
    { "step": 9, "action": "Fix lots.tap.js: Update helper functions to use service layer instead of direct SQL", "done": false },
    { "step": 10, "action": "Add collision/determinism tests: Same input produces same ID, duplicates handled gracefully", "done": false },
    { "step": 11, "action": "Verify all cli-qif-to-sqlite tests pass", "done": false },
    { "step": 12, "action": "Commit with descriptive message", "done": false }
  ],
  "verification": [
    "All cli-qif-to-sqlite tests pass",
    "Entity IDs match patterns (acc_*, cat_*, sec_*, tag_*, prc_*, lot_*, txn_*)",
    "Same entity inserted twice produces same ID (deterministic)",
    "Database rejects true duplicates via UNIQUE constraints",
    "No lint errors"
  ],
  "notes": [
    "SIMPLIFIED: Removed stateful createIdGenerator - session-scoped state doesn't help across restarts",
    "All entities now use simple hashFields with explicit field selection",
    "Database UNIQUE constraints handle collision detection, not application code",
    "Empty string vs null issue: prefer null, don't normalize to empty string"
  ],
  "id_strategies": {
    "all_entities": {
      "method": "hashFields",
      "pattern": "prefix_<12-hex-chars>",
      "collision_handling": "database UNIQUE constraint"
    }
  },
  "bugs_to_fix": [
    "lots.js line 273: if (action === 'Grant') if (action === 'Vest') - incomplete conditional",
    "lots.js insertLot: circular ID reference when lotData includes id field",
    "accounts.js: conflict detection doesn't check name field",
    "securities.js: null vs '' for symbol produces same hash"
  ]
}
